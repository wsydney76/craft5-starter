{# Structured Data, no need to render this in preview #}

{% if not craft.app.request.isPreview %}

    {% set schema = craft.schema %}
    
    {% set organization = schema.organization
        .url(siteUrl('/'))
        .email(siteInfo.email)
        .telephone(siteInfo.phoneNumber)
        .name(siteInfo.copyright ?? siteInfo.title) %}

    {% set address = siteInfo.addresses.one %}
    {% if address %}
        {% do organization.location(schema.place
            .address("#{address.addressLine1} #{address.postalCode} #{address.locality}")) %}
    {% endif %}

    {% set sectionRoots = customConfig.sectionRoots ?? ['_entries'] %}

    {# TODO: Enable for nested entries #}
    {% if entry.section %}
        {% set roots = sectionRoots|map(r => "#{r}/#{entry.section.handle}_#{entry.type.handle}/json-ld.twig") %}
        {% set roots = roots|merge(sectionRoots|map(r => "#{r}/#{entry.section.handle}/json-ld.twig")) %}
        {% set roots = roots|push('_partials/json-ld.twig') %}

        {% include roots with {
            entry,
            organization
        } only %}
        
    {% endif %}

    
{% endif %}